# 测试数据

## 设备数据

子网关地址：47ac607c
子网关下子设备地址：1d651702

顶层网关设备编号：16df85ab-a749-5a35-04d0-8bc8819ba825

## 遥测上报测试数据
主题：gateway/telemetry
```json
{
  "gateway_data": {
    "switch": 1
  },
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "temperature": 28.5,
        "version": "v0.1",
        "switch": true
      },
      "sub_device_data": {
        "1d651702": {
          "temperature": 28.3
        }
      }
    }
  }
}
```

## 属性上报测试数据
主题：gateway/attributes/32sd56qw
```json
{
  "gateway_data": {
    "online_status": "online",
    "signal_strength": 85
  },
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "location": "Building A-2F",
        "firmware_version": "v1.2.3",
        "online_status": "online"
      },
      "sub_device_data": {
        "1d651702": {
          "battery_level": 78,
          "location": "Room 201"
        }
      }
    }
  }
}
```

## 事件上报测试数据
主题：gateway/event/523afef
```json
{
  "gateway_data": {
    "method": "SystemAlert",
    "params": {
      "alert_type": "system_start",
      "timestamp": 1726581600,
      "message": "Gateway system started successfully"
    }
  },
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "method": "TemperatureAlert",
        "params": {
          "temperature": 35.2,
          "threshold": 30.0,
          "timestamp": 1726581650,
          "severity": "warning"
        }
      },
      "sub_device_data": {
        "1d651702": {
          "method": "BatteryAlert",
          "params": {
            "battery_level": 18,
            "threshold": 20,
            "timestamp": 1726581700,
            "status": "low_battery"
          }
        }
      }
    }
  }
}
```

## 命令控制测试数据

### 1. 顶层网关遥测控制
主题：gateway/telemetry/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "gateway_data": {
    "switch": 0,
    "brightness": 75
  }
}
```

### 2. 子网关遥测控制
主题：gateway/telemetry/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "switch": false,
        "mode": "auto"
      }
    }
  }
}
```

### 3. 子网关下子设备遥测控制
主题：gateway/telemetry/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "sub_gateway_data": {
    "47ac607c": {
      "sub_device_data": {
        "1d651702": {
          "switch": true,
          "temperature_threshold": 30
        }
      }
    }
  }
}
```

### 4. 顶层网关属性控制
主题：gateway/attributes/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "gateway_data": {
    "location": "Data Center A",
    "description": "Main gateway device"
  }
}
```

### 5. 子网关属性控制
主题：gateway/attributes/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "location": "Building A-3F",
        "description": "Sub-gateway for floor 3"
      }
    }
  }
}
```

### 6. 子网关下子设备属性控制
主题：gateway/attributes/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "sub_gateway_data": {
    "47ac607c": {
      "sub_device_data": {
        "1d651702": {
          "location": "Room 301",
          "description": "Temperature sensor"
        }
      }
    }
  }
}
```

## 命令下发测试数据

### 1. 顶层网关命令下发
主题：gateway/command/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "gateway_data": {
    "method": "SystemRestart",
    "params": {
      "delay": 30,
      "reason": "maintenance",
      "timestamp": 1726581900
    }
  }
}
```

### 2. 子网关命令下发
主题：gateway/command/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "method": "UpdateFirmware",
        "params": {
          "version": "v2.1.1",
          "url": "http://example.com/firmware.bin",
          "checksum": "abc123def456",
          "force": false
        }
      }
    }
  }
}
```

### 3. 子网关下子设备命令下发
主题：gateway/command/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "sub_gateway_data": {
    "47ac607c": {
      "sub_device_data": {
        "1d651702": {
          "method": "SetThreshold",
          "params": {
            "temperature_high": 35.0,
            "temperature_low": 10.0,
            "humidity_high": 80,
            "alert_enabled": true
          }
        }
      }
    }
  }
}
```

### 4. 批量命令下发（多设备）
主题：gateway/command/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "gateway_data": {
    "method": "SyncTime",
    "params": {
      "timestamp": 1726581950,
      "timezone": "UTC+8"
    }
  },
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "method": "SyncTime",
        "params": {
          "timestamp": 1726581950,
          "timezone": "UTC+8"
        }
      },
      "sub_device_data": {
        "1d651702": {
          "method": "Calibrate",
          "params": {
            "sensor_type": "temperature",
            "offset": -0.5,
            "timestamp": 1726581950
          }
        }
      }
    }
  }
}
```

### 5. 复杂命令下发（配置更新）
主题：gateway/command/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "method": "UpdateConfig",
        "params": {
          "config_type": "network",
          "config_data": {
            "wifi_ssid": "IoT_Network",
            "mqtt_host": "mqtt.example.com",
            "mqtt_port": 1883,
            "report_interval": 60
          },
          "apply_immediately": true
        }
      }
    }
  }
}
```

### 6. 诊断命令下发
主题：gateway/command/control/16df85ab-a749-5a35-04d0-8bc8819ba825
```json
{
  "gateway_data": {
    "method": "RunDiagnostic",
    "params": {
      "test_types": ["network", "storage", "sensors"],
      "report_format": "json",
      "include_logs": true
    }
  },
  "sub_gateway_data": {
    "47ac607c": {
      "gateway_data": {
        "method": "RunDiagnostic",
        "params": {
          "test_types": ["network", "sensors"],
          "report_format": "json",
          "include_logs": false
        }
      },
      "sub_device_data": {
        "1d651702": {
          "method": "SelfTest",
          "params": {
            "test_duration": 30,
            "test_parameters": ["temperature", "humidity"],
            "return_raw_data": true
          }
        }
      }
    }
  }
}
```

## 测试场景说明

### 场景1：基础多层数据上报
1. 顶层网关 `16df85ab-a749-5a35-04d0-8bc8819ba825` 上报自身遥测数据
2. 子网关 `47ac607c` 通过顶层网关上报遥测数据
3. 子设备 `1d651702` 通过子网关和顶层网关链路上报数据

### 场景2：多层级控制命令
1. 平台向顶层网关发送控制命令
2. 平台通过顶层网关向子网关发送控制命令  
3. 平台通过多层链路向子设备发送控制命令

### 场景3：设备状态管理
1. 各层级设备状态监控
2. 离线设备检测和恢复
3. 心跳数据收集和分析


## 预期结果验证

### 数据存储验证
- 遥测数据正确存储到 `telemetry_datas` 表
- 属性数据正确存储到 `attribute_datas` 表  
- 事件数据正确存储到 `event_datas` 表
- 设备状态正确更新

### 设备关系验证
- 设备父子关系正确建立
- 多层级设备树结构完整
- 设备配置关联正确

### 消息路由验证
- 上行数据正确解析和存储
- 下行控制命令正确路由
- 多层级消息传递无丢失