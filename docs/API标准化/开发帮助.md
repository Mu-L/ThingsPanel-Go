# 开发帮助

## 项目结构

```text
project-root/
├── main.go                         # 主程序入口
├── middleware/                     # 中间件
│   └── response/                  # 响应处理
│       ├── middleware.go          # 响应中间件
│       └── response.go            # 响应结构体定义
├── pkg/                           # 公共包
│   ├── errcode/                  # 错误码处理
│   │   ├── code.go              # 错误码常量
│   │   ├── error.go             # 错误定义
│   │   ├── manager.go           # 错误码管理器
│   │   └── validator.go         # 错误码验证
│   └── metrics/                  # 性能监控
│       └── metrics.go            # 监控指标定义
├── config/                       # 配置文件
│   ├── config.yaml              # 主配置文件
│   └── messages.yaml            # 错误消息配置
├── go.mod                        # Go模块文件
└── README.md                     # 项目说明文档
```

## 使用示例

### 1. internal/service/user.go

```go
package service

import (
    "context"
    "project/pkg/errcode"
)

type UserService struct {
    repo UserRepository
}

func NewUserService(repo UserRepository) *UserService {
    return &UserService{repo: repo}
}

func (s *UserService) GetUser(ctx context.Context, id int64) (*User, error) {
    if id <= 0 {
        return nil, errcode.New(errcode.CodeParamError, "invalid user id")
    }

    user, err := s.repo.GetUser(ctx, id)
    if err != nil {
        if isNotFoundError(err) {
            return nil, errcode.New(errcode.CodeNotFound, "user not found")
        }
        return nil, errcode.WithData(errcode.CodeDBError, "database error", err.Error())
    }
    
    return user, nil
}
```

### 2. internal/api/handler/user.go

```go
package handler

import (
    "github.com/gin-gonic/gin"
    "project/internal/service"
    "project/pkg/errcode"
)

type UserHandler struct {
    userSvc *service.UserService
}

func NewUserHandler(svc *service.UserService)*UserHandler {
    return &UserHandler{userSvc: svc}
}

func (h *UserHandler) GetUser(c*gin.Context) {
    id := c.GetInt64Param("id")

    user, err := h.userSvc.GetUser(c, id)
    if err != nil {
        c.Error(err)
        return
    }
    
    c.Set("data", user)
}
```
